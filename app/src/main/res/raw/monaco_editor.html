<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #1e1e2e;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
        }
        #editor {
            width: 100%;
            height: 100%;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1e2e;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a4a6a;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6a6a8a;
        }
    </style>
</head>
<body>
    <div id="editor"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script>
        let editor = null;
        
        require.config({
            paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' }
        });

        require(['vs/editor/editor.main'], function() {
            // Define custom Mermaid theme
            monaco.editor.defineTheme('mermaid-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'keyword', foreground: '7C3AED', fontStyle: 'bold' },
                    { token: 'string', foreground: '10B981' },
                    { token: 'comment', foreground: '6B7280', fontStyle: 'italic' },
                    { token: 'identifier', foreground: '06B6D4' },
                    { token: 'delimiter', foreground: 'EC4899' }
                ],
                colors: {
                    'editor.background': '#1e1e2e',
                    'editor.foreground': '#f8f8fc',
                    'editor.lineHighlightBackground': '#2a2a40',
                    'editor.selectionBackground': '#7C3AED44',
                    'editorCursor.foreground': '#7C3AED',
                    'editorLineNumber.foreground': '#6B7280',
                    'editorLineNumber.activeForeground': '#A78BFA',
                    'editor.selectionHighlightBackground': '#7C3AED22'
                }
            });

            editor = monaco.editor.create(document.getElementById('editor'), {
                value: '',
                language: 'markdown',
                theme: 'mermaid-dark',
                fontSize: 15,
                lineHeight: 24,
                fontFamily: "'JetBrains Mono', 'Fira Code', 'Consolas', monospace",
                fontLigatures: true,
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                automaticLayout: true,
                wordWrap: 'on',
                tabSize: 4,
                insertSpaces: true,
                renderWhitespace: 'selection',
                cursorBlinking: 'smooth',
                cursorSmoothCaretAnimation: 'on',
                smoothScrolling: true,
                folding: true,
                lineNumbers: 'on',
                glyphMargin: false,
                bracketPairColorization: { enabled: true },
                padding: { top: 12, bottom: 12 },
                scrollbar: {
                    vertical: 'auto',
                    horizontal: 'auto',
                    verticalScrollbarSize: 8,
                    horizontalScrollbarSize: 8
                },
                quickSuggestions: false,
                parameterHints: { enabled: false },
                autoClosingBrackets: 'always',
                autoClosingQuotes: 'always',
                formatOnPaste: false,
                formatOnType: false
            });

            // Listen for content changes
            editor.onDidChangeModelContent(function() {
                if (typeof AndroidBridge !== 'undefined') {
                    AndroidBridge.onCodeChanged(editor.getValue());
                }
            });

            // Notify editor ready
            if (typeof AndroidBridge !== 'undefined') {
                AndroidBridge.onEditorReady();
            }
        });

        // API Functions
        function getCode() {
            return editor ? editor.getValue() : '';
        }

        function setCode(code) {
            if (editor) {
                const position = editor.getPosition();
                editor.setValue(code);
                if (position) editor.setPosition(position);
            }
        }

        function insertText(text) {
            if (editor) {
                const selection = editor.getSelection();
                editor.executeEdits('insert', [{
                    range: selection,
                    text: text,
                    forceMoveMarkers: true
                }]);
                editor.focus();
            }
        }

        function setTheme(theme) {
            if (monaco && monaco.editor) {
                monaco.editor.setTheme(theme);
            }
        }

        function getSelectedText() {
            if (editor) {
                const sel = editor.getSelection();
                return sel ? editor.getModel().getValueInRange(sel) : '';
            }
            return '';
        }

        function selectAll() {
            if (editor) {
                editor.setSelection(editor.getModel().getFullModelRange());
            }
        }

        function undo() {
            if (editor) editor.trigger('keyboard', 'undo', null);
        }

        function redo() {
            if (editor) editor.trigger('keyboard', 'redo', null);
        }
    </script>
</body>
</html>

